{"version":3,"sources":["../../../src/events/builder.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-empty-object-type */\n\ntype obj<T> = T extends { [key: string | number]: any } ? { [K in keyof T]: T[K] } : never;\n\nexport type EmptyPayload = {\n  [key: string]: never;\n  _e: never;\n  _t: never;\n};\n\ntype AbstractPayload = Record<string, any> & {\n  _e?: never;\n  _t?: never;\n};\n\nexport type Event<\n  Name extends string = string,\n  Payload extends AbstractPayload = EmptyPayload,\n> = obj<{ key: Name } & Payload>;\n\nexport type EventShape<Name extends string, Payload = any> = Name & {\n  __payload: Payload;\n};\n\ntype getEventPayloadOfShape<Shape> =\n  Shape extends EventShape<infer Name, infer Payload>\n    ? Payload extends AbstractPayload\n      ? { [K in Name]: Payload }\n      : never\n    : never;\n\ntype getEventsOfShapesRec<Shapes, Out = {}> = Shapes extends readonly [infer Shape, ...infer Rest]\n  ? getEventsOfShapesRec<Rest, Out & getEventPayloadOfShape<Shape>>\n  : obj<Out>;\n\ntype reduceEventLoggerEvents<EventLogger> =\n  EventLogger extends EventLoggerType<infer Category, infer Events>\n    ? Category extends string\n      ? {\n          [K in keyof Events]: K extends string\n            ? obj<{ key: `${Category}:${K}` } & Events[K]>\n            : never;\n        }[keyof Events]\n      : never\n    : never;\n\ntype reduceEventLoggersRec<EventLoggers, Out = never> = EventLoggers extends readonly [\n  infer EventLogger,\n  ...infer Rest,\n]\n  ? reduceEventLoggersRec<Rest, Out | reduceEventLoggerEvents<EventLogger>>\n  : obj<Out>;\n\ninterface EventLoggerType<Category, Events> {\n  category: Category;\n  __eventTypes?: () => Events;\n}\n\nexport interface EventLogger<Category, Events> extends EventLoggerType<Category, Events> {\n  <EventName extends keyof Events>(event: EventName, data: Events[EventName]): void;\n\n  path(target: string): string;\n  path(target: string | null | undefined): string | null;\n}\n\nexport interface EventBuilder {\n  event<const Name extends string, const Payload extends AbstractPayload>(): EventShape<\n    Name,\n    Payload\n  >;\n}\n\nexport interface EventLoggerBuilder {\n  <const Category extends string, const Shapes extends readonly EventShape<string>[]>(\n    category: Category,\n    _fn: (builder: EventBuilder) => Shapes\n  ): EventLogger<Category, getEventsOfShapesRec<Shapes>>;\n}\n\nexport type collectEventLoggers<EventLoggers extends [...EventLoggerType<any, any>[]]> =\n  reduceEventLoggersRec<EventLoggers>;\n"],"names":[],"mappings":"AAAA,0DAA0D"}