{"version":3,"sources":["../../../../src/start/interface/commandsTable.ts"],"sourcesContent":["import { ExpoConfig } from '@expo/config';\nimport chalk from 'chalk';\nimport wrapAnsi from 'wrap-ansi';\n\nimport * as Log from '../../log';\nimport type { McpServer } from '../server/MCP';\n\n// Approximately how many rows apart from the commands table (usage guide on `expo start`)\n// will be printed after the QR code? The `rows` input doesn't account for all of them,\n// so we add our best guess instead.\nconst RESERVED_ROWS = 6;\n\nexport const BLT = '\\u203A';\n\nexport type StartOptions = {\n  isWebSocketsEnabled?: boolean;\n  devClient?: boolean;\n  reset?: boolean;\n  nonPersistent?: boolean;\n  maxWorkers?: number;\n  platforms?: ExpoConfig['platforms'];\n  mcpServer?: McpServer;\n};\n\nexport const printHelp = (): void => {\n  logCommandsTable([{ key: '?', msg: 'show all commands' }]).print();\n};\n\nexport const getTerminalColumns = () => process.stdout.columns || 80;\n\nexport const printItem = (text: string, opts?: { dim: boolean }): string => {\n  let output = `${BLT} ` + wrapAnsi(text, getTerminalColumns()).trimStart();\n  if (opts?.dim) {\n    output = chalk`{dim ${output}}`;\n  }\n  return output;\n};\n\nexport function printUsage(\n  options: Pick<StartOptions, 'devClient' | 'isWebSocketsEnabled' | 'platforms'>,\n  { verbose, rows }: { verbose: boolean; rows?: number }\n) {\n  const isMac = process.platform === 'darwin';\n\n  const { platforms = ['ios', 'android', 'web'] } = options;\n\n  const isAndroidDisabled = !platforms.includes('android');\n  const isIosDisabled = !platforms.includes('ios');\n  const isWebDisable = !platforms.includes('web');\n\n  const switchMsg = `switch to ${options.devClient === false ? 'development build' : 'Expo Go'}`;\n  const target = options.devClient === false ? `Expo Go` : 'development build';\n\n  const printPrefix = ({ short }: { short: boolean }) => {\n    Log.log();\n    let message = chalk`Using {cyan ${target}}`;\n    if (!short) {\n      message += chalk` {dim (Press {bold s} to ${switchMsg})}`;\n    }\n    Log.log(printItem(message));\n  };\n\n  if (verbose) {\n    printPrefix({ short: true });\n    return logCommandsTable([\n      { key: 's', msg: switchMsg },\n      {},\n      { key: 'a', msg: 'open Android', disabled: isAndroidDisabled },\n      { key: 'shift+a', msg: 'select an Android device or emulator', disabled: isAndroidDisabled },\n      isMac && { key: 'i', msg: 'open iOS simulator', disabled: isIosDisabled },\n      isMac && { key: 'shift+i', msg: 'select an iOS simulator', disabled: isIosDisabled },\n      { key: 'w', msg: 'open web', disabled: isWebDisable },\n      {},\n      { key: 'r', msg: 'reload app' },\n      !!options.isWebSocketsEnabled && { key: 'j', msg: 'open debugger' },\n      !!options.isWebSocketsEnabled && { key: 'm', msg: 'toggle menu' },\n      !!options.isWebSocketsEnabled && { key: 'shift+m', msg: 'more tools' },\n      { key: 'o', msg: 'open project code in your editor' },\n      { key: 'c', msg: 'show project QR' },\n      {},\n    ]).print();\n  }\n\n  const table = logCommandsTable([\n    { key: 's', msg: switchMsg },\n    {},\n    { key: 'a', msg: 'open Android', disabled: isAndroidDisabled },\n    isMac && { key: 'i', msg: 'open iOS simulator', disabled: isIosDisabled },\n    { key: 'w', msg: 'open web', disabled: isWebDisable },\n    {},\n    { key: 'j', msg: 'open debugger' },\n    { key: 'r', msg: 'reload app' },\n    !!options.isWebSocketsEnabled && { key: 'm', msg: 'toggle menu' },\n    !!options.isWebSocketsEnabled && { key: 'shift+m', msg: 'more tools' },\n    { key: 'o', msg: 'open project code in your editor' },\n    {},\n  ]);\n\n  // If we're not in verbose mode, we check if we have enough space. If we don't, we don't print\n  // the full usage guide and rely on the `printHelp()` message being shown instead\n  if ((rows || Infinity) - RESERVED_ROWS > table.lines) {\n    printPrefix({ short: true });\n    table.print();\n  } else {\n    printPrefix({ short: false });\n  }\n}\n\ninterface LogCommandsOutput {\n  lines: number;\n  print(): void;\n}\n\nfunction logCommandsTable(\n  ui: (false | { key?: string; msg?: string; status?: string; disabled?: boolean })[]\n) {\n  const lines = ui\n    .filter((x) => !!x)\n    .map(({ key, msg, status, disabled }) => {\n      if (!key) return '';\n      let view = `${BLT} `;\n      if (key.length === 1) view += 'Press ';\n      view += chalk`{bold ${key}} {dim â”‚} `;\n      view += msg;\n      if (status) {\n        view += ` ${chalk.dim(`(${chalk.italic(status)})`)}`;\n      }\n      if (disabled) {\n        view = chalk.dim(view);\n      }\n      return view;\n    });\n  return {\n    lines: lines.length,\n    print() {\n      Log.log(lines.join('\\n'));\n    },\n  };\n}\n"],"names":["BLT","getTerminalColumns","printHelp","printItem","printUsage","RESERVED_ROWS","logCommandsTable","key","msg","print","process","stdout","columns","text","opts","output","wrapAnsi","trimStart","dim","chalk","options","verbose","rows","isMac","platform","platforms","isAndroidDisabled","includes","isIosDisabled","isWebDisable","switchMsg","devClient","target","printPrefix","short","Log","log","message","disabled","isWebSocketsEnabled","table","Infinity","lines","ui","filter","x","map","status","view","length","italic","join"],"mappings":"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"}